<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0107)http://www.jspsmart.com/scripts/showsource/showsource.asp?VPATH=/scripts/demo/jspSmartUpload/en/sample4.jsp -->
<HTML><HEAD>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<META content="MSHTML 6.00.2462.0" name=GENERATOR></HEAD>
<BODY><PRE><CODE>&lt;%@&nbsp;page&nbsp;language="java"&nbsp;import="java.sql.*,com.jspsmart.upload.*"%&gt; <BR>&lt;jsp:useBean&nbsp;id="mySmartUpload"&nbsp;scope="page"&nbsp;class="com.jspsmart.upload.SmartUpload"&nbsp;/&gt; <BR> <BR>&lt;HTML&gt; <BR>&lt;BODY&nbsp;BGCOLOR="white"&gt; <BR> <BR>&lt;H1&gt;jspSmartUpload&nbsp;:&nbsp;Sample&nbsp;4&lt;/H1&gt; <BR>&lt;HR&gt; <BR> <BR>&lt;% <BR> <BR>	//&nbsp;Variables <BR>	int&nbsp;count=0; <BR> <BR>	//&nbsp;Connect&nbsp;to&nbsp;the&nbsp;database <BR>	Class.forName("org.gjt.mm.mysql.Driver").newInstance(); <BR>	Connection&nbsp;con&nbsp;=&nbsp;DriverManager.getConnection("jdbc:mysql:///test"); <BR> <BR>	//&nbsp;SQL&nbsp;Request <BR>	Statement&nbsp;stmt&nbsp;=&nbsp;con.createStatement(ResultSet.TYPE_FORWARD_ONLY&nbsp;,ResultSet.CONCUR_UPDATABLE); <BR>	ResultSet&nbsp;rs&nbsp;=&nbsp;stmt.executeQuery("SELECT&nbsp;*&nbsp;FROM&nbsp;TFILES&nbsp;WHERE&nbsp;ID=1"); <BR> <BR>	//&nbsp;if&nbsp;the&nbsp;resultset&nbsp;is&nbsp;not&nbsp;null <BR>	if&nbsp;(rs.next()){ <BR> <BR>		//&nbsp;Initialization <BR>		mySmartUpload.initialize(pageContext); <BR> <BR>		//&nbsp;Upload <BR>		mySmartUpload.upload(); <BR> <BR>		//&nbsp;upload&nbsp;file&nbsp;in&nbsp;the&nbsp;DB&nbsp;if&nbsp;this&nbsp;file&nbsp;is&nbsp;not&nbsp;missing <BR>		if&nbsp;(!mySmartUpload.getFiles().getFile(0).isMissing()){ <BR> <BR>			try&nbsp;{ <BR> <BR>				rs.updateString("FILENAME",mySmartUpload.getFiles().getFile(0).getFileName()); <BR>				 <BR>				//&nbsp;Add&nbsp;the&nbsp;current&nbsp;file&nbsp;in&nbsp;the&nbsp;DB&nbsp;field <BR>				mySmartUpload.getFiles().getFile(0).fileToField(rs,"FILE"); <BR> <BR>				//&nbsp;Update <BR>				rs.updateRow(); <BR>				count++;		 <BR>				 <BR>			}&nbsp;catch(Exception&nbsp;e)&nbsp;{ <BR>				out.println("An&nbsp;error&nbsp;occurs&nbsp;:&nbsp;"&nbsp;+&nbsp;e.toString());				 <BR>			}			 <BR> <BR>		} <BR> <BR>	} <BR> <BR>	//&nbsp;Display&nbsp;the&nbsp;number&nbsp;of&nbsp;files&nbsp;uploaded <BR>	out.println(count&nbsp;+&nbsp;"&nbsp;file(s)&nbsp;uploaded&nbsp;in&nbsp;the&nbsp;database."); <BR> <BR>	rs.close(); <BR>	stmt.close(); <BR>	con.close(); <BR> <BR>%&gt; <BR> <BR>&lt;/BODY&gt; <BR>&lt;/HTML&gt; <BR> <BR> <BR> <BR> <BR></CODE></PRE></BODY></HTML>
